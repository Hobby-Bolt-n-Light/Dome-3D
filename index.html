<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Bilder's 3D Archive</title>

  <!-- A-Frame -->
  <!-- <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script> -->
  <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>

  <!-- Extras（移動・補助用） -->
  <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>

  <!-- Particle System -->
  <!--<script src="https://cdn.jsdelivr.net/npm/aframe-particle-system-component@1.1.4/dist/aframe-particle-system-component.min.js"></script>-->
  <!-- <script src="https://unpkg.com/aframe-particle-system-component@1.1.x/dist/aframe-particle-system-component.min.js"></script> -->
  <!-- <script src="aframe-particle-system-component.js"></script> -->

  <style>
    body { margin: 0; overflow: hidden; }

    /* 移動UI */
    .ui {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
      z-index: 10;
    }
    .ui button {
      padding: 12px 16px;
      font-size: 16px;
      opacity: 0.8;
    }
  </style>
</head>

<body>

<!-- UIボタン -->
<div class="ui">
  <button onclick="move(0, -0.3)">↑</button>
  <button onclick="move(-0.3, 0)">←</button>
  <button onclick="move(0.3, 0)">→</button>
  <button onclick="move(0, 0.3)">↓</button>
</div>

<a-scene>

  <!-- アセット管理 -->
  <a-assets>
    <img id="sky" src="kloppenheim_06_puresky_small.jpg">
    <video id="movie" src="movie_test.mp4" loop muted playsinline></video>
    <a-asset-item id="dome" src="BOD_VR_Test2.glb"></a-asset-item>
  </a-assets>

  <!-- 空（回転で向き調整） -->
  <a-sky src="#sky" rotation="0 -90 0"></a-sky>

  <!-- 空間モデル -->
  <a-gltf-model
    src="#dome"
    position="0 0 0"
    scale="2 2 2">
  </a-gltf-model>

  <!-- パーティクル（六角形がゆっくり上昇） -->
  <a-entity
    position="0 3 0"
    particle-system="
      preset: dust;
      particleCount: 150;
      texture: https://cdn.jsdelivr.net/gh/IdeaSpaceVR/aframe-particle-system-component/examples/assets/particle.png;
      velocityValue: 0 0.2 0;
      size: 0.3;
      opacity: 0.6;
      maxAge: 6;
    ">
  </a-entity>
  
  <a-entity position="0 1 -0.5"
    spe-particles="
    texture: star.png;
    color: #FF0000, #FFFF00, #00FFFF, #FF00FF;
    distribution: BOX;
    opacity: 1,1,1,0;
    velocity: 0 0.5 0;
    velocity-spread: 0.2 0 0.2; 
    blending: normal;
    particle-count: 100;
    angle: 0, 6.28;
    maxAge: 3; ">
  </a-entity> 

  <!-- 動画スクリーン -->
  <a-plane
    position="0 1.8 -4"
    width="3"
    height="1.7"
    material="src: #movie">
  </a-plane>

  
	<a-plane
		id = "video-border"
		width = "17" height = "10"
		position = "0 5 -20"
		color = "#440000"
		video-controls>		
		<a-video  
			id = "video-display"
			width="16" height="9" 
			position="0 0 0.1"
			src="#movie">
		</a-video>
	</a-plane>

  <!-- カメラリグ（円形移動制限） -->
  <a-entity id="rig" position="0 0.01 0">
    <a-camera
      look-controls
      wasd-controls="acceleration: 10">
    </a-camera>
  </a-entity>

</a-scene>

<script>
  const rig = document.getElementById('rig');
  const radius = 4; // 円形移動範囲

  function move(dx, dz) {
    const pos = rig.object3D.position;
    pos.x += dx;
    pos.z += dz;

    // 円形制限
    const dist = Math.sqrt(pos.x * pos.x + pos.z * pos.z);
    if (dist > radius) {
      pos.x *= radius / dist;
      pos.z *= radius / dist;
    }
  }

  // 動画再生（スマホ対策）
  document.body.addEventListener('click', () => {
    const video = document.getElementById('movie');
    video.play();
  }, { once: true });
</script>

</body>
</html>
