<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Bilder's 3D Archive</title>

  <!-- A-Frame -->
  <!-- <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script> -->
  <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>

  <!-- ExtrasÔºàÁßªÂãï„ÉªË£úÂä©Áî®Ôºâ -->
  <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>

  <!-- Particle System -->
  <!--<script src="https://cdn.jsdelivr.net/npm/aframe-particle-system-component@1.1.4/dist/aframe-particle-system-component.min.js"></script>-->
  <!-- <script src="https://unpkg.com/aframe-particle-system-component@1.1.x/dist/aframe-particle-system-component.min.js"></script> -->
  <!-- <script src="aframe-particle-system-component.js"></script> -->

  <style>
    body { margin: 0; overflow: hidden; }

    /* ÁßªÂãïUI */
    .ui {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
      z-index: 10;
    }
    .ui button {
      padding: 12px 16px;
      font-size: 16px;
      opacity: 0.8;
    }
  </style>
</head>

<body>

<!-- UI„Éú„Çø„É≥ -->
<div class="ui">
  <button onclick="move(0, -0.3)">‚Üë</button>
  <button onclick="move(-0.3, 0)">‚Üê</button>
  <button onclick="move(0.3, 0)">‚Üí</button>
  <button onclick="move(0, 0.3)">‚Üì</button>
</div>

<a-scene id="scene">

  <!-- „Ç¢„Çª„ÉÉ„ÉàÁÆ°ÁêÜ -->
  <a-assets>
    <img id="sky" src="kloppenheim_06_puresky_small.jpg">
    <video id="movie_main3" src="assets/VR_Video_MainScreen_Anim_NoAudio.mp4" loop autoplay></video>
    <video id="movie" src="assets/TEST-1.mp4" loop autoplay></video>
    <a-asset-item id="dome" src="assets/BOD_v3_Env.glb"></a-asset-item>
    <a-asset-item id="screen" src="assets/BOD_v3_Screen.glb"></a-asset-item>
  </a-assets>

  <!-- Á©∫ÔºàÂõûËª¢„ÅßÂêë„ÅçË™øÊï¥Ôºâ -->
  <a-sky src="#sky" rotation="0 -90 0"></a-sky>

  <!-- Á©∫Èñì„É¢„Éá„É´ -->
  <a-gltf-model
    src="#dome"
    position="0 0 0"
    scale="2 2 2">
  </a-gltf-model>
	
  <a-gltf-model
    src="#screen"
    position="0 0.1 0"
    scale="2 2 2"
	material="src: #movie_main3">
  </a-gltf-model>

  <!-- „Éë„Éº„ÉÜ„Ç£„ÇØ„É´ÔºàÂÖ≠ËßíÂΩ¢„Åå„ÇÜ„Å£„Åè„Çä‰∏äÊòáÔºâ -->
  <!--
  <a-entity
    position="0 3 0"
    particle-system="
      preset: dust;
      particleCount: 150;
      texture: https://cdn.jsdelivr.net/gh/IdeaSpaceVR/aframe-particle-system-component/examples/assets/particle.png;
      velocityValue: 0 0.2 0;
      size: 0.3;
      opacity: 0.6;
      maxAge: 6;
    ">
  </a-entity>
  
  <a-entity position="0 1 -0.5"
    spe-particles="
    texture: star.png;
    color: #FF0000, #FFFF00, #00FFFF, #FF00FF;
    distribution: BOX;
    opacity: 1,1,1,0;
    velocity: 0 0.5 0;
    velocity-spread: 0.2 0 0.2; 
    blending: normal;
    particle-count: 100;
    angle: 0, 6.28;
    maxAge: 3; ">
  </a-entity> 
  -->

  <!-- <a-entity rotation="0 90 0" position="0 -5 -10" particle-system="preset:star; color: #f216b0,#f24535"></a-entity> -->

  <!-- ÂãïÁîª„Çπ„ÇØ„É™„Éº„É≥ -->
  <a-plane
    position="0 1 -4"
    width="3"
    height="1.7"
    material="src: #movie">
  </a-plane>


  <!-- „Ç´„É°„É©„É™„Ç∞ÔºàÂÜÜÂΩ¢ÁßªÂãïÂà∂ÈôêÔºâ -->
  <a-entity id="rig" position="0 -1.3 0">
    <a-camera
      look-controls
      wasd-controls="acceleration: 10">
    </a-camera>
  </a-entity>

</a-scene>

<script>
  const rig = document.getElementById('rig');
  const radius = 4; // ÂÜÜÂΩ¢ÁßªÂãïÁØÑÂõ≤

  function move(dx, dz) {
    const pos = rig.object3D.position;
    pos.x += dx;
    pos.z += dz;

    // ÂÜÜÂΩ¢Âà∂Èôê
    const dist = Math.sqrt(pos.x * pos.x + pos.z * pos.z);
    if (dist > radius) {
      pos.x *= radius / dist;
      pos.z *= radius / dist;
    }
  }


	
document.body.addEventListener('click', () => {
  document.getElementById('movie').play();
}, { once: true });

const scene = document.getElementById('scene');

scene.addEventListener('loaded', () => {
  const model = document.querySelector('[gltf-model]');

  model.addEventListener('model-loaded', () => {
    const root = model.getObject3D('mesh');
    const video = document.getElementById('movie_main3');

    const videoTexture = new AFRAME.THREE.VideoTexture(video);
    videoTexture.flipY = false;
    videoTexture.colorSpace = AFRAME.THREE.SRGBColorSpace;
    videoTexture.needsUpdate = true;

    root.traverse(obj => {
      if (obj.type === 'Mesh' && obj.name === 'Screen') {
		obj.material.color.setRGB(1, 1, 1);   // ‚Üê ÈáçË¶Å
        obj.material.map = videoTexture;
        obj.material.needsUpdate = true;

        console.log('üé• Video texture applied to:', obj.name);
      }
    });
  });
});
</script>

</body>
</html>
